<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Waste Eye</title>


    <link rel="stylesheet" href="index.css">
    <script type="text/javascript" src="index.js"></script>
</head>

<body>
	<!-- TOP BAR -->
    <div class="navbar">
        <div class="brand">
            <img src="./img/logo.png" style="height:50%">
            <p style="font-size:30px">WASTE EYE</p>
        </div>
		<div class="poweredby">
			<span>Powered by</span>
			<img src="img/vision.png" class="icon"><img src="img/gpt.png" class="icon">
		</div>
    </div>

	<div class="sidenav">
		<label><b>About</b></label>
		<p>Don't know where to put your trash? <br>
			Take a picture and Waste Eye will tell you!</p>

		<hr>
		<br>

		<label for="img" style="text-align: center;"><b>Sort waste by name</b></label>
		<br>
		<form>
            <input type="text">
            <input type="submit">
		</form>

		<br>
		<hr>
		<br>

		<label for="img" style="text-align: center;"><b>Upload image from device</b><label>	
		<br>
		<br>
		<input type="file" id="imgForm" name="img" accept="image/*">
		<input type="submit" onclick="submitFormPic()">
		
		<br>
		<br>
		<hr>
		<br>	
		
		<label><b>Use your camera<b></label>
		<br>
		<br>

		<button onclick="startVideo()">Take a Picture</button>
		<button onclick="takePic()">Snap</button>
		<button onclick="submitPic()">Submit</button>

		<br>
		<br>
		<hr>
	</div>

	<div class="center">
		<p class="responseText">RESPONSE TEXT</p>
		<video class = "videoInsert" autoplay="true" id="videoElement"></video>
		<canvas id = "canvas" style="overflow: auto;"></canvas>
	</div>

    <!--Outputs generated by index.js-->
    <div id="output__boxes">
        <div class="outputBox">
            <h2 class="outputBox__header">dmasidaindddddddddddddddddddddddddddddddddddddddddddddddddddddddddd</h2>
        </div>
    </div>
</body>

<script>
    function tab(tabname) {

        var img, txt
        img = document.getElementById("img")
        txt = document.getElementById("txt")

        if (tabname == "img") {
            img.style.display = "flex";
            txt.style.display = "none";
        }
        else {
            img.style.display = "none";
            txt.style.display = "flex";
        }

    }

    function startVideo() {
        let video = document.querySelector("#videoElement");
        let canvas = document.getElementById("canvas")
        video.removeAttribute("hidden")
        canvas.setAttribute("hidden", "hidden")

        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (stream) {
                    video.srcObject = stream;
                })
                .catch(function (error) {
                    console.log("something went wrong")
                })
        } else {
            console.log("unsupported.")
        }
    }

    function takePic() {
        var canvas = document.getElementById("canvas");
        var video = document.querySelector("video");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0, canvas.width, canvas.height);

        canvas.removeAttribute("hidden")
        video.setAttribute("hidden", "hidden");
    }

    async function submitPic() {
        const canvas = document.getElementById('canvas');
        const base64 = canvas.toDataURL("image/png").replace(/^data:image\/?[A-z]*;base64,/, "");

        console.log(base64);

        const response = await fetch("http://localhost:3000/analyze", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                image: base64
            })
        });

		const data = await response.json()
        .then(data => {
            generateOutputs(data);
        })
        
    }

    async function submitFormPic() {
        const img = document.getElementById
    }

</script>

</html>